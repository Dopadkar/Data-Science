# Предсказание температуры стали

## Описание проекта

Чтобы оптимизировать производственные расходы, металлургический комбинат ООО «Так закаляем сталь» решил уменьшить потребление электроэнергии на этапе обработки стали. Вам предстоит построить модель, которая предскажет температуру стали.

Сталь обрабатывают в металлическом ковше вместимостью около 100 тонн. Чтобы ковш выдерживал высокие температуры, изнутри его облицовывают огнеупорным кирпичом. Расплавленную сталь заливают в ковш и подогревают до нужной температуры графитовыми электродами. Они установлены в крышке ковша.

Из сплава выводится сера (десульфурация), добавлением примесей корректируется химический состав и отбираются пробы. Сталь легируют — изменяют её состав — подавая куски сплава из бункера для сыпучих материалов или проволоку через специальный трайб-аппарат (англ. tribe, «масса»).

Перед тем как первый раз ввести легирующие добавки, измеряют температуру стали и производят её химический анализ. Потом температуру на несколько минут повышают, добавляют легирующие материалы и продувают сплав инертным газом. Затем его перемешивают и снова проводят измерения. Такой цикл повторяется до достижения целевого химического состава и оптимальной температуры плавки.

Тогда расплавленная сталь отправляется на доводку металла или поступает в машину непрерывной разливки. Оттуда готовый продукт выходит в виде заготовок-слябов (англ. slab, «плита»).

Оптимизация производственных расходов на металлургическом комбинате. Необходимо уменьшить потребление электроэнергии на этапе обработки стали. Построена модель, которая предскажет температуру стали.


## Данные

Данные состоят из файлов, полученных из разных источников:

- `data_arc_new.csv` — данные об электродах;
- `data_bulk_new.csv` — данные о подаче сыпучих материалов (объём);
- `data_bulk_time_new.csv` *—* данные о подаче сыпучих материалов (время);
- `data_gas_new.csv` — данные о продувке сплава газом;
- `data_temp_new.csv` — результаты измерения температуры;
- `data_wire_new.csv` — данные о проволочных материалах (объём);
- `data_wire_time_new.csv` — данные о проволочных материалах (время).

Во всех файлах столбец `key` содержит номер партии. В файлах может быть несколько строк с одинаковым значением `key`: они соответствуют разным итерациям обработки.

## Задача

Предсказывать температуру плавления стали.

## Используемые библиотеки
*Python*, *Pandas*, *Matplotlib*, *NumPy*, *Scikit-learn*, *исследовательский анализ данных*, *предобработка данных*, *визуализация данных* 

## План проекта

### 1. Проведение обзора данных (EDA)

1.1. Подготовка данных:

- Импорт необходимых библиотек;
- Чтение файлов и сохранение полученных данных в переменные;
- Получение общей информации о таблицах (head, info, describe);
- Корректировка наименований столбцов (при необходимости).
- Выводы

1.2. Анализ данных:

- Графическое представление данных из таблиц;
- Проверка данных на аномалии.
- Выводы

1.3. Предобработка данных:

- Корректировка типов данных (при необходимости)
- Заполнение пропусков / удаление дубликатов (при наличии)
- Добавление признаков
- Агрегирование по ключу
- Соединение таблиц
- Выделение признаков и таргета
- Выводы;

1.4. Исследование итоговой таблицы с данными:

- аналитический анализ
- графический анализ
- корреляционный анализ
- выводы

### 2. Построение модели машинного обучения

2.1. Обучение модели:

- Разделение данных на обучающую и тестовую выборки;
- Масштабирование данных;
- Обучение модели линейной регрессии;
- Обучение модели решающих деревьев;
- Обучение модели случайного леса;
- Обучение модели градиентного бустинга с перебором гиперпараметров - LGBM;
- Обучение модели градиентного бустинга с перебором гиперпараметров - CatBoost;
- Обучение константной модели;
- Выбор лучшей модели.

2.2. Проверка лучшей модели:

- Тестирование лучшей модели на тестовой выборке;
Если MAE на тестовых данных > 6.8 - доработка модели.
- Анализ важности факторов
- Выводы

3. Отчёт. Общий вывод

##  Общий вывод

1. Пункты плана

В ходе работы над проектом прогнозирования температуры стали все пункты плана были выполнены. Мы произвели:

- Загрузку данных;
- Разведывательный анализ данных (EDA), включая первичное знакомствои и визуальный анализ;
- Предобработка данных, включая заполнение пропусков и борьба с выбросами;
- Объединение данных и анализ итоговой таблицы;
- Масштабирование данных, поскольку все из них бфли количественные;
- Обучение моделий выбор лучшей с последующей проверкой на тестовой выборке;
- Анализ важности признаков модели.

Все эти пункты были выполнены, поскольку былм результвтом вдумчивой работы и у нас не возникло лишних проблем с данными, их низким качество, загрузкой, бвлвнсом и полнотой после удаления лишних признаков и записей. В эти пункты традиционны для анализа данных и в совокупности дают хороших эффект для успешной работы.

2. Преодолённые трудности

В рамках работы с данными перед нами возникли следующие трудности:

- изменение типов данных для временных переменных;
- пропущенные значения - для одних данных мы просто удалили записи с отсутствующими данными (конечная температура), а для других - заполнили пропуски нулями (сыпучме и проволочные материалы);
- неполнота некоторых данных - вы добавили два новых признака (полная мощность и энергия);
- выбросы - для одних данные (реактивная мощность) мы заменили выброс средним значением по признаку без выброса, а в друних (энергия);
- мультиколлениарность - два признака оказались сильно скоррелированными в результате чего мы удалили один из них;

3. Ключевые шаги

3.1. Первичный анализ данных

- Данные ноомально загружены;
- В данных по реактивной мощности есть подозрение на выброс;
- У материалов замечены пропуски в данных, которые вполне можно заполнить нулями;
- У замеров температуры удалены данные с пропусками, т.к. они не несуть информации;
- Во многих данных имеется определённое число забракованных партий, данные по которым отсутствуют. Лучше всего представлены данные по продувке газом.
- Для удобства анализа некоторые наименования столбцов были скорректированы.
- Данные о времени добавления сыпучих и проволочных материалов не нужны.

3.2. Визуальный анализ данных

- У реактивной мощности был обнаружен выброс. Он был заменём на среднее по партии
- У температуры был обнаружен выброс. Он был удалён.
- У данных по объёмам подаче сыпучих и проволочны материалов также были обнаружен выбросы у ряда признаков. Но удалять их мы не стали, т.к. это в этом нет необходимости.

3.3. Предобработка данных

- Все пропуски, где необходимо, удалены или заполнены;
- Дубликаты отсутствуют;
- Создан итоговый датасет с подготовленными данными.

3.4. Анализ итоговой таблицы

В ходе анализа итоговой таблмцы данных мы:

- Выявили один признак отсутствующий материал, признак которого можно спокойно удалить.
- Обнаружили и удалили пару выбросов.
- Корреляционный анализ выявиз сильную взаимосвясь между парой переменных, одну из которых пришлось исклюсить, чтобы улучшить работу моделей.

3.5. Обучение модели

В ходе построения модели машинного обучения мы:

- Разделили данные на признаки и целевое значение.
- Маштабировали признаки.
- Разделили данные на обучающую и тестовую выборку в отношении 3:1.

Были обучены шесть моделей машинного обучнения:

- Линейная регрессия
- Решающие деревья
- Случайный лес
- Градиентный бустинг - LGBM
- Градиентный бустинг - CatBoost
- Константная модель

Наихудший результат совершенно естественно показала константная модель. Также очень плохой результат показала модель решающего дерева с MAE 7.371440.

Все остальные обученные модели прошли минимальный порог в 6.8 MAE внутри кросс-валидации.

Высркую оценку получили модели линейной регрессии и LGBM с MAE около 6.59.

Ещё лучше показала себя модель случайного леса с MAE 6.50.

Наилучшие результаты на кросс-валидации показала модель градиентного бустинга CatBoostRegressor с MAE 6.3. Проведем проверку работы этой моделей на тестовой выборке.

- Обучили шесть моделей методом кросс-валидации;
- Выбрали наилучшую модель (CatBoost) и проверили её на тестовой выборке;

3.6. Важность признаков:

В ходе анализа важности признаков установлено, что:

- начальной температуры** и энергии важны для прогноза;
- нет никакой прямолинейной зависимости между признаками и точностью модели;
- признак и bulk_14 и wire_1 имеют положительное влияние на предсказательную способность нашей модели;
- признаки bulk_4 и bulk_12 в целом не оказывают положительного или отрицательного эффекта на модель;
- большие концентрации bulk_1 отрицательно сказываются на прогнозе модели. * бризнак bulk_6, wire_2 и остальные 16 признаков также не улучшают нашу модель.

3.7. Наилучшая модель и её качество

Наилучшие результаты на кросс-валидации показала модель градиентного бустинга CatBoostRegressor. Метрика качества MAE равеа 6.3. Проведем проверку работы этой моделей на тестовой выборке.

3.8. Cписок признаков для обучения лучшей модели

Признаки для обучения лучшей модели и их предобработка:

- **Начальная температура** (initial_temperature) - не потребовал изменений;
- **Конечная температура** (final_temperature ) - при предобработке были удалены записи с пропусками этого целевого признака;
- **Энергия** (energy_expended) - этот показатель был рассчитан и добавлен на основе значений времени нагрева и полной мощности, которык затем были удалены как избыточные признаки;
- **Сыпучие материалы** bulk_1, bulk_2, bulk_3, bulk_4, bulk_5, bulk_6, bulk_7, bulk_8, bulk_10, bulk_11, bulk_12, bulk_13; bulk_14, bulk_15 - потребовали заполнения пропусков нулями и удаления одного из признаков (а именно bulk_9) из-за того, что все его значения в итоговой таблице оказались нулевыми;
- **Подача газа материалы** gas - не потребовали предобработки;
- **Проволочные материалы материалы** wire_1, wire_2, wire_3, wire_4, wire_6, wire_7, wire_8, wire_9 - потребовали заполнения пропусков нулями и удаления одного из признаков (а именно wire_5) в рамках борьбы с мультиколлениарностью;

Также перед обучением все признаки были масштабированы.

3.9. Гиперпараметры лучшей модели

Наилучшие результаты на кросс-валидации показала модель градиентного бустинга CatBoostRegressor с MAE 6.3. Проведем проверку работы этой моделей на тестовой выборке.

Гиперпараметры модели следующие:

- loss_function = MAE;
- random_state = 24042023;
- learning_rate = 0.03;
- iterations = 500;

4. Рекомендации по улучшению модели, решения

Для улучшения модели можно выбрать несколько направлений:

Упрощение модели:

- использовать классификацаю, а не регрессию. Для этого нужно изменить подход с предсказания значения на его тип. Маожно предказывать класс температуры: в пределах необходимых температур (0), выше необходимых значений (1) или ниже (-1). Тогда можно предсказать, будет тот или иной подход экономным и оптимальным или убыточным и неэффективным;
- удалить ряд признаков, важность которых была незначительной по результатам SHAP;
- можно объединить ряд редких материалов в обшие признаки, чтобы уменьшить сложность и размерность модели;

Усложнение модели:

- использовать доволнительные данные (бригада, выполняющая работу; химический состав материала или газ; особенности оборудования (электроды, измерители температуры, поставщики материалов и оборудования и т.п.);
- учитывать время операции над партией (часы и минуты, часть дня, день недели, будни или выходные,месяц, время года и т.д.);
- использовать данные о времени добавления материалов и встроить в модель временные ряды;

Как один, так и другой подход могут улучшить качество молеои, упростить её использование и решить задачу заказчика.
